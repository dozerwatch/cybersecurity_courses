# CSE 365 Spring 2024

- [Talking Web](#talking-web)
- [Assembly Crash Course](#assembly-crash-course)
- [Building a Web Server](#building-a-web-server)

## Talking Web

## Assembly Crash Course

## Building a Web Server
- 

### Levels
In this series of challenges, you will be writing assembly to interact with your environment, and ultimately build a web server. 

All solutions will be in `server.s`. Every level has the following boilerplate. We include what is necessary for conciseness in the challenge solutions. We use this [table](https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/) and `man 2 <command>` for help.
```assembly
.intel_syntax noprefix
.global _start

.section .text

.section .data

_start:
```
Compile the assembly code and submit to get the flag:
```
as -o server.o server.s && ld -o server server.o
/challenge/run ./server
```
### Level 1
In this challenge you will exit a program.
```assembly
# Exit program
mov rax, 60
mov rdi, 0
syscall
```
### Level 2
In this challenge you will create a socket.

Specifically, the level wants `socket(AF_INET, SOCK_STREAM, IPPROTO_IP)`.
```assembly
# Create TCP/IP socket
mov rax, 41
mov rdi, 2
mov rsi, 1
mov rdx, 0
syscall

# r10: Socket FD
mov r10, rax

# Exit program
```
### Level 3
In this challenge you will bind an address to a socket. 

Specifically, the level wants 

`bind(3, {sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr("0.0.0.0")}, 16)`. 

Note that the arguments for **bind** are given by 

`int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);`,

and **sockaddr** is defined as

`struct sockaddr {sa_family_t sa_family; char sa_data[14];}`.

The structure for **sockaddr_in** is 

`struct sockaddr_in {uint16_t sin_family; uint16_t sin_port; uint32_t sin_addr; uint8_t __pad[8];}`.
```assembly
# var sockaddr_in
.section .data
sockaddr_in:
    .2byte 2
    .byte 0
    .byte 80
    .4byte 0
    .8byte 0

# Create TCP/IP socket
# r10: Socket FD

# Bind 0.0.0.0:80 to socket
mov rax, 49
mov rdi, r10
mov rsi, offset sockaddr_in     # lea rsi, sockaddr_in
mov rdx, 16
syscall

# Exit program
```
### Level 4
In this challenge you will listen on a socket.

Specifically, the level wants `listen(3, 0) = 0`.
```assembly
# var sockaddr_in
# Create TCP/IP socket
# r10: Socket FD
# Bind 0.0.0.0:80 to socket

# Listen on socket
mov rax, 50
mov rdi, r10
mov rsi, 0
syscall

# Exit program
```
### Level 5
In this challenge you will accept a connection.

Specifically, the level wants `accept(3, NULL, NULL) = 4`.
```assembly
# var sockaddr_in
# Create TCP/IP socket
# r10: Socket FD
# Bind 0.0.0.0:80 to socket
# Listen on socket

# Accept a connection
mov rax, 43
mov rdi, r10 
mov rsi, 0
mov rdx, 0
syscall

# Exit program
```
### Level 6
